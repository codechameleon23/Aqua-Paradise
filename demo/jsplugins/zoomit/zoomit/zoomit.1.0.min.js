(function(e){e.widget("ui.zoomit",{options:{zoompopup:true,repeat:true,keyboard:true,scrolllock:true,thumbactiveClass:"",moveOnMouse:true,loginText:'<span class="zmit_loding"><i class="fa fa-spinner fa-spin"></i></span>',callbacks:{beforeopen:function(){},onopen:function(){},onclose:function(){},opentransitionend:function(){},closetransitionend:function(){}}},_create:function(){var t=this,n=t.options,r=t.element;t.currentIrem=0;t.ImgArr=[];t.ispopup=false;t.mouseX=0;t.mouseY=0;t.displayArea=r.find(".zmit_displayArea");t.thumbArea=r.find(".zmit_thumbArea");t.zoomArea=r.find(".zmit_zoomArea").bind({click:function(n){t.mouseX=n.pageX-e(this).offset().left;t.mouseY=n.pageY-e(this).offset().top}}).prepend(n.loginText);t.zoomImgholder=r.find(".zmit_zoomImgholder").bind({click:function(e){if(e.pageX<t.getViewportWidth()/2){t.prevItem()}else{t.nextItem()}}}).appendTo(t.zoomArea);t.displayimgHolder=r.find(".zmit_displayImgHolder").bind({click:function(){t.openPopup()}});r.find(".zmit_thumbArea a.zoomit_thumb").each(function(){e(this).children("img").addClass("zoomit_thumbImg");t.ImgArr.push(this)}).bind({click:function(){t.currentIrem=e.inArray(this,t.ImgArr);t.changeDisplay()}});t.zoomimg=e("<img/>",{"class":"zmit_zoomImg"}).appendTo(t.zoomImgholder);t.zoomOpenIco=r.find(".zmit_zoomArea_open").bind({click:function(){t.openPopup()}});t.displayAreaNext=r.find(".zmit_control_btn_next").bind({click:function(){t.nextItem()}});t.displayAreaPrev=r.find(".zmit_control_btn_prev").bind({click:function(){t.prevItem()}});t.zoomCloseIco=r.find(".zmit_zoomArea_close").bind({click:function(){t.closePopup()}});t.changeDisplay();t.zoomArea.popup({scrolllock:n.scrolllock,onopen:function(){t.ispopup=true;t.changeZoom();if(n.keyboard){t.zoomArea.keyup(function(e){if(e.keyCode===37){t.prevItem()}if(e.keyCode===39){t.nextItem()}})}},onclose:function(){t.ispopup=false}});t.displayMaxHeight=t.displayimgHolder.height();t.displayMaxWidth=t.displayimgHolder.width();t.displaySrcHeight=0;t.displaySrcWidth=0;t.zoomMaxHeight=t.zoomArea.height();t.zoomMaxWidth=t.zoomArea.width();t.zoomSrcHeight=0;t.zoomSrcWidth=0;e(window).resize(function(){if(t.ispopup){}t.displayimgPosition()});if(/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)){n.moveOnMouse=false;e("body").addClass("touchDevice")}else{n.moveOnMouse=n.moveOnMouse;e("body").removeClass("touchDevice")}},nextItem:function(){if(this.currentIrem<parseInt(this.ImgArr.length-1)){this.currentIrem++}else{if(this.options.repeat){this.currentIrem=0}else{}}this.changeDisplay()},prevItem:function(){if(this.currentIrem>0){this.currentIrem--}else{if(this.options.repeat){this.currentIrem=parseInt(this.ImgArr.length-1)}else{}}this.changeDisplay()},openPopup:function(){if(this.options.zoompopup){this.zoomArea.popup("show")}},closePopup:function(){if(this.options.zoompopup){this.zoomArea.popup("hide")}},changeDisplay:function(){el=this;el.displayimgHolder.html(el.options.loginText);el.displayimg=e("<img/>",{"class":"zmit_displayImg"}).bind({click:function(){el.openPopup()}});var t=el.displayimg;var n=new Image;n.onload=function(){t.src=this.src;el.displayimg.attr("src",this.src).hide();el.displayimgHolder.html(el.displayimg);el.displaySrcHeight=this.height;el.displaySrcWidth=this.width;el.displayimgPosition()};n.src=e(el.ImgArr[el.currentIrem]).children("img.zoomit_thumbImg").data("medium");el.thumbArea.find(".zoomit_thumb").removeClass(el.options.thumbactiveClass).eq(el.currentIrem).addClass(el.options.thumbactiveClass);if(el.ispopup){el.changeZoom()}},changeZoom:function(){el=this;el.zoomArea.unbind("mousemove");var t=el.zoomimg.hide();var n=new Image;n.onload=function(){t.src=this.src;el.zoomimg.attr("src",this.src).show();el.zoomSrcHeight=this.height;el.zoomSrcWidth=this.width;el.displayimgPosition();if(el.options.moveOnMouse){e("body").removeClass("touchDevice");el.zoomArea.bind("mousemove",function(t){var n=e(this);var r=n.offset();el.mouseX=t.pageX-r.left;el.mouseY=t.pageY-r.top;el.zoomMaxHeight=n.height();el.zoomMaxHeight=n.width();el.displayimgPosition()})}else{e("body").addClass("touchDevice")}};n.src=e(el.ImgArr[el.currentIrem]).children("img.zoomit_thumbImg").data("large")},displayimgPosition:function(){function u(e,t){r=e/t;if(e>el.displayMaxHeight){e=el.displayMaxHeight;t=e/r;return u(e,t)}else if(t>el.displayMaxWidth){t=el.displayMaxWidth;e=t*r;return u(e,t)}else{return{hasHeight:e,hasWidth:t}}}el=this;if(el.ispopup){el.zoomMaxHeight=el.zoomArea.height();el.zoomMaxWidth=el.zoomArea.width();var e=el.zoomSrcWidth/el.zoomMaxWidth;var t=el.zoomSrcHeight/el.zoomMaxHeight;var n=el.mouseX*e-el.mouseX;var i=el.mouseY*t-el.mouseY;if(el.zoomSrcWidth<el.zoomMaxWidth&&el.zoomSrcHeight<el.zoomMaxHeight){el.zoomimg.css({top:"50%",left:"50%",marginLeft:el.zoomSrcWidth/2*-1,marginTop:el.zoomSrcHeight/2*-1,position:"absolute"})}else{if(el.zoomSrcHeight>el.zoomMaxHeight&&el.zoomSrcWidth<=el.zoomMaxWidth){el.zoomimg.css({top:i*-1+"px",left:el.zoomMaxWidth/2-el.zoomSrcWidth/2+"px",marginLeft:"",marginTop:"",position:""})}else if(el.zoomSrcHeight<=el.zoomMaxHeight&&el.zoomSrcWidth>el.zoomMaxWidth){el.zoomimg.css({top:el.zoomMaxHeight/2-el.zoomSrcHeight/2+"px",left:n*-1+"px",marginLeft:"",marginTop:"",position:""})}else{el.zoomimg.css({top:i*-1+"px",left:n*-1+"px",marginLeft:"",marginTop:"",position:""})}}}el.displayMaxHeight=el.displayimgHolder.height();el.displayMaxWidth=el.displayimgHolder.width();if(el.displaySrcWidth<el.displayMaxWidth&&el.displaySrcHeight<el.displayMaxHeight){var s=el.displaySrcHeight;var o=el.displaySrcWidth}else{var s=u(el.displaySrcHeight,el.displaySrcWidth).hasHeight;var o=u(el.displaySrcHeight,el.displaySrcWidth).hasWidth}el.displayimg.css({height:s+"px",top:el.displayMaxHeight/2-s/2+"px",left:el.displayMaxWidth/2-o/2+"px"}).fadeIn()},getViewportWidth:function(){if(window.innerWidth){return window.innerWidth}else if(document.body&&document.body.offsetWidth){return document.body.offsetWidth}else{return 0}},getViewportHeight:function(){if(window.innerHeight){return window.innerHeight}else if(document.body&&document.body.offsetHeight){return document.body.offsetHeight}else{return 0}}})})(jQuery)